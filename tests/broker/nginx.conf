# This file is part of the Consumer API example.
#
# Copyright (C) 2023 Serghei Iakovlev <egrep@protonmail.ch>
#
# For the full copyright and license information, please view
# the LICENSE file that was distributed with this source code.

upstream broker_upstream {
    # fail_timeout=0 means we always retry an upstream even if it failed
    # to return a good HTTP response
    server broker:9292 fail_timeout=0;
}

server {
    listen 443 ssl;
    listen [::]:443 ssl;

    include /etc/nginx/snippets/self-signed.conf;
    include /etc/nginx/snippets/ssl-params.conf;

    server_name localhost;

    location / {
        # checks for static file, if not found proxy to app
        try_files $uri @proxy_to_app;
    }

    location @proxy_to_app {
        include /etc/nginx/snippets/proxy-params.conf;
        proxy_pass http://broker_upstream;
    }
}
